<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Commander - UNEVIE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .operator-card.active {
            border-color: #2563eb;
            background-color: #eff6ff;
            box-shadow: 0 0 0 2px #3b82f6;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">

    <div th:replace="fragments/header :: header"></div>

    <div class="max-w-2xl mx-auto py-10 px-6">
        <div class="bg-white rounded-2xl shadow-xl p-8">

            <div class="mb-6 pb-6 border-b">
                <h1 class="text-2xl font-bold mb-2">Finaliser votre commande</h1>
                <div class="flex items-center gap-4 bg-blue-50 p-4 rounded-lg">
                    <img th:if="${produit.imageUrl}" th:src="@{'/uploads/' + ${produit.imageUrl}}"
                        class="w-16 h-16 object-cover rounded-md">
                    <div th:unless="${produit.imageUrl}"
                        class="w-16 h-16 bg-gray-100 rounded-md flex items-center justify-center">
                        <i class="fa-solid fa-image text-gray-400"></i>
                    </div>
                    <div>
                        <h2 class="font-semibold text-lg" th:text="${produit.nom}"></h2>
                        <p class="text-blue-600 font-bold" th:text="${produit.prix} + ' FCFA'"></p>
                    </div>
                </div>
            </div>

            <!-- Stepper Indicator -->
            <div class="flex justify-between items-center mb-8 px-10">
                <div id="step-1-indicator" class="flex flex-col items-center">
                    <div
                        class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold shadow-lg">
                        1</div>
                    <span class="text-sm font-semibold mt-1">Infos</span>
                </div>
                <div class="flex-1 h-1 bg-gray-200 mx-4 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-blue-600 w-0 transition-all duration-300"></div>
                </div>
                <div id="step-2-indicator" class="flex flex-col items-center opacity-50">
                    <div
                        class="w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">
                        2</div>
                    <span class="text-sm font-semibold mt-1">Paiement</span>
                </div>
            </div>

            <form th:action="@{/produits/valider-commande}" th:object="${commande}" method="post" id="commandeForm"
                class="space-y-5">
                <input type="hidden" name="produitId" th:value="${produit.id}">
                <input type="hidden" th:field="*{operateur}" id="hidden-operateur">

                <!-- STEP 1: Infos & Options -->
                <div id="step-1" class="transition-opacity duration-300">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700">Votre Nom & Pr√©noms</label>
                            <input type="text" th:field="*{nomClient}" required id="input-nom"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700">T√©l√©phone</label>
                            <input type="tel" th:field="*{telephone}" required id="input-tel"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                        </div>

                        <!-- üöó Champs Sp√©cifiques Voiture -->
                        <div id="fields-voiture"
                            class="hidden space-y-4 p-4 bg-gray-50 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-blue-700 flex items-center gap-2">
                                <i class="fa-solid fa-car"></i> Options V√©hicule
                            </h3>
                            <label class="flex items-center gap-3 cursor-pointer group">
                                <input type="checkbox" th:field="*{avecChauffeur}"
                                    class="w-5 h-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                                <span class="group-hover:text-blue-600 transition">Avec chauffeur</span>
                            </label>
                            <div>
                                <label class="block text-sm font-medium mb-1 text-gray-700">Lieu de prise en
                                    charge</label>
                                <input type="text" th:field="*{lieuPriseEnCharge}" placeholder="Ex: A√©roport, H√¥tel..."
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                            </div>
                        </div>

                        <!-- üè† Champs Sp√©cifiques R√©sidence -->
                        <div id="fields-residence"
                            class="hidden space-y-4 p-4 bg-gray-50 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-yellow-700 flex items-center gap-2">
                                <i class="fa-solid fa-house"></i> Options R√©sidence
                            </h3>
                            <div>
                                <label class="block text-sm font-medium mb-1 text-gray-700">Nombre de jours</label>
                                <input type="number" th:field="*{nombreJours}" min="1" value="1"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-yellow-500 transition-all">
                            </div>
                        </div>

                        <!-- üçó Champs Sp√©cifiques Poulet -->
                        <div id="fields-poulet"
                            class="hidden space-y-4 p-4 bg-gray-50 rounded-xl border border-gray-200">
                            <h3 class="font-semibold text-green-700 flex items-center gap-2">
                                <i class="fa-solid fa-drumstick-bite"></i> Options Commande
                            </h3>
                            <div>
                                <label class="block text-sm font-medium mb-1 text-gray-700">Quantit√©</label>
                                <input type="number" th:field="*{quantite}" min="1" value="1"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-green-500 transition-all">
                            </div>
                        </div>

                        <div id="field-localisation-general">
                            <label class="block text-sm font-medium mb-1 text-gray-700">Votre Localisation /
                                Adresse</label>
                            <input type="text" th:field="*{localisation}" required id="input-loc"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700">Mode de Paiement</label>
                            <select th:field="*{modePaiement}" id="payment-select"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none transition-all cursor-pointer">
                                <option value="CASH">Esp√®ces (√† la livraison)</option>
                                <option value="TELEPHONE">Mobile Money (Wave, Orange, MTN, Moov)</option>
                            </select>
                        </div>
                    </div>

                    <div class="pt-6">
                        <button type="button" id="btn-next"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition-all shadow-lg active:scale-95">
                            Suivant <i class="fa-solid fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- STEP 2: Paiement / Validation -->
                <div id="step-2" class="hidden space-y-6 transition-opacity duration-300">
                    <div id="payment-mobile" class="hidden space-y-6">
                        <div class="text-center space-y-4">
                            <h3 class="text-xl font-bold text-gray-800">Choisissez votre op√©rateur</h3>
                            <div class="grid grid-cols-2 gap-4 sm:grid-cols-4">
                                <button type="button"
                                    class="operator-card p-3 border-2 rounded-xl transition hover:shadow-md flex flex-col items-center gap-2"
                                    data-op="Wave">
                                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAABUFBMVEUdyP8BAgL+/v70fyAfx/8A1f/1dC8dyv/0fxwezP8ezv/5giEAAgIg3P/8/Pzj4+MGKTD19fV+fn6MjIxeXl7r6+suLi6EhITX19fMzMzufB8f0f8dxvgVFRWrq6vGxsZ2dnY9PT29vb1ra2uWlpYYqtgShKYVmsUcvvBOTk61tbUIU2wQfJ8NaogDIy4atOIADRMIOEljY2MVm8bLaRracRwYCwALXXQPDw8CMUEZrdShoaE0NDQAExqMRxByOw8KWXcFQVUBKTpEREQLZYMavegGIysJN0RDIgdcMAtQKQmZTxS/YxgwGAWAQxCkVhYlEgQLT2CyXBUOYXMeDgBiMggReI8UkrIWnsAAGiYjIyMAU3RWutvbdTqWZF6Wqan/fwDNkVq6mXjdhFXPkXiIsMO5npXdj23vgj3JmYlwudydrLg3FADRlITHcUaBZWtRtT8UAAALr0lEQVR4nO2d+1caSRbHbdQtuzESH6hAK4ryUEAkgPGtGDE+iE6cGIyb3XV3ZpLJzM7u///bVjeo0HWruhuc1GVPfX/IyeEUOf3Jrbq36vaty8CAkpKSkpKSkpKSkpKSkpKSkpKSkpKSklK3GnqU7Cf5UzSkx4ZftDQci5H/M0piDA9nSrm3L5s6TieN4Rghsh/ruUR0w0geaw4V02ZM12U/23OI6GYm58RrKlsySd8zEmIWOHy2IW8zfT5XCSmkPmnaKJ/xsK8ZCck0sny4lnIFvV8RiV7IfXIFpMvx1uxPRF3fzu95ANS0o1SmHx0OMW6z654ANW0tlek/K1LAqkc+CzHXd1Yk+ra7j+lA7Le1qBdee52iDxO1vxBJJu8P0Ar+Rh8hkljKmxdt12GhfwiJnqz6BqShv3/mKTGZk4QXHd0asp/cq4y0l60Mq3y/hAw905UJqRp9YkSj0Z0JNe24P4yoZ/Ki45JQyb4gNLbXuuQb1XL9cFYkJNW1CbVPtT4wop457JZP649pahSY/drm1MLSovPDOfrhG4awH6I+KTmfenF5NhxKTHV+uDsZCYfiC86xRRO9EclAymms+fEA1exKx4fL9oehJSci/njB7thmbJZAYH667cOlUPPD+LRjdBJ9WkqvOWNFoskSmG2fp8utD8NOI6bRxwuj5px3cQjmgXBsxjE6h9+GBV+E4xOO0UXshGQg7SQUz9JXjtEn6AlNpyvVlsJNmMn2D6dmW+7HOfoEe0AkJvseZsdCHJvv9JoTNnecifmfsO9qiFllCLWJeCSy4wwLS4lIZH6XGbtXQk6omycsoR/tpbETZjiEXo8bo3nkSUU92aMNtbcx1IRET/tPlDoIcduQHn/FhKdnZ2enwhFbuPfeRD8WLLjzy4t6uVyuX1wKIF8mUSfciFHkPfm7y6tyNBgcGRkJBqPlq8sfOOPWSrgJ9beOB26Z9NTGG3yQBXlx2jHiQXupmGwKS4RzxtELW4BZNvbrlcE2vibjYKW+/wOA+Hr4O8MAsoqcDHCHrCc7T4ej2imdnAzeoyEr5auDdw7E99IJiWGm89lcEsqo6Gnn+feATk4Ir8UYDFbOHN94L/sMTIzCyd66tr6WzzBmJEaKSegfVLiAFmLl3PmFYkGuqyFG8gEiy5T6EOM9uwrPK1wjBoN11qUW5YYLuml5SodmnWkjEgMItY3rKIhI1+EFMPyoJNOZEtKx0Kqlzi0WeHaifmSf+hoWMFo/AAA17eOwvOpaYpS2OjxfsdHxokEvQAGffuH8qtOf0r/TgMgJ+j9KJDQKThsdpdoRjSQUDi1t3NCQH226T/pnlMZCxsU8EsqbpcTMMfvqvXztaTEaTLB40ofzg4vrerlSqZTr1/sHgp1pdkDa3lu/hSbhYeFxMcbEVTQbp+fnZzdn56fvRKO0qrRwodfgWsNswWj9pw//KHz0NomO/FVp4ULfrsKPlC01EYnx2iuhSGsNSQuRmGmeH6k2DOu/Xc/4qtbj6qOknaleO+ausqOctUtlXW23hHLChV4QWGjdqvYxktzzry8dy9l7EyIsVrMQh9l9d1fKyknV0GUotNDoceHFx2cBtJwzRkL6YLVnIpQULtwJterzLEPtRE64oITOLNOfpXVphM9kInfClJS8NzFL1e9FmJdTVUOSz7NjcdeopCpMvfYsu04vkhUuMrluyyr9qrgth5CUvpczXbuVc7owaj7vwfRAKOeESMzGUY+PPr00M7Ow4jpsLTUgJ+9t+L3M1KHNleVEJBQOh2fj80tzwqF70q6yGY2ufc3m1GqoVaQYCIyF4wsixr28rPuIULLNm+4mQ2OBdo2vTm3yh0sKF1RGhn/OF2lltZPPrp6d2OQmpN7KCRc2Yq2bjc2rCMNnVe1Ncq0okXAoxku4iQBnIUA6Uyd539gqyXuJOBTzbcUVDqAAUeqNUt+Ic3EeIFBAi4HQ91pc5QNSdwOH/718TeqrbkOUV3RqZlxEGFiFvc17udeDCEX0Wmv4hrsIW/N0BkR8L/1l/rZHxLsdMWAgMMteDdKsdJvsggyvDQWmQm6EgWVo/1ZMy673thA97G6m510BAyHIiFvSCS1EDweNqbA74dgO8EUMLRasteiGeDfPbkeBlegscrckOVx4RVxxX4VU48vAV18jIPTgUZfFsfBBEYgQRccailgVAc6BRwpWzAU2zQ4XGBAHxCcND6GiqXn2oFgtyXc1toSInvyMPU3ZkCg/ILY0FBO8uxccKhzTlLkPrK3jufNs1HiIr7xOUuAKGw0XaAgHjCQnO+XRk1pKOL87iomQ6Gk4ZggPhp2anWK+/RpRyyFOt5bNhHfCMHvWz8o+XbTLuIWqTKZcToYdYrc1VUz31kkmDxBOeNh1P4rdfa818CxEK9sPOJtld64nxReZ78t5mc8R2NvLw9HwSYCrQUVIIF/ji5BtkKFJezsDiZhsNdSi5+2NJSBxiqpDHTHYO+q+XGlgjM1+Z1ERmuzVUR97NkssYRXTzXxKyETEpV4JUXVvo4RMPmPBTzjET2iwnsYnIZCrSWFahwChry0N3dTcMf8CpnABbdsmvJ+dLM2zKUVMPQYJ8DKqd0JM4UIHyhZ9rsMdNlWzto3Ihr0TQllhRB1b9RJbPrzUc7TQEPUeMBpser/3iK/Jqm4DZDDNoZ5h14ap6y4hwI909LzzxhQuwCzGbsIPIVh2UixgIdQLUMvSXk/AVJLLFZ4E32pzrVFoF5DFoJJX3eaQAd5qW/b6XsZSgu1rRoWmGQ+cL+0xm4iLkGk7a8mPMx2DtjQ05GOJh8Yt+Hw+3lsAWX1chI1eCWFHo6XREMI2nPR+floF/wH0hPzKWafAoiFUs7QEvyNNeCUMOfu0toTHl3Juqe94naZApQIuQt5NfW8lUVb3VhgQz56GFOCbiZseX12EYE+KaF8KvyHVPHtTqOrLUhXN2QJoj+xnmnLvJCBKmHJCvja303X1paUUjtI2S1AmypaXClqw+NIWolwbAY/AthHdCUOLHMAjTPlSk+NqvJQnci8/HaNxNHC/xJZcKzIiPBNqDTSrcMBKelc5j7nrEhPH2bLElrYQJYQpYY03TbUFcUzk7Lk1XJPUvubN65KlCSMGf46OoqqnsbxplWsM4Ibsg+Akoi1UlXsD9jTl3kzYTfAQw85fKGkzIZ4a4Zb0bX73mpU4jBjmBgpNK2KpZH+ULjCitgJaMcS/6Wy1DkMGSOfpraAvyCJ7GB6PTAiaDlRLiKpLW+IeoWzdTUY6GMdCOyuCjgN7OXwmtH4VsCpAnFtZnn3cho+HEgu8A0XThEhuzHSKEHFLibvFydV4ZDY0G4nvLO0KDKhpJwju5kEyHlpf8q57zU1PL75aWpmedlQHjTr/cojm1ahDVs6t+ZDvLvepwE66kPE+HFjDH5uzS+7oLVDriHFTr0SbqpQvRZOxabTz64fh0bLd3/tTCu8PsZDYX7V9q5H+k8Cm5G06qHQMD15bP46AFpAa8fPfmF95iMJ9yZuzucwMD/7dwDpHLRP+I3gPNJe/4rQm37gE2tEH7/+J9ncsifmv+xGwgX4d9DkbFyNQv/2R+58+Y4yGAkAL8ZwNIR8ugGb7tixE2TSAiLkzyAGkiNdMk/KNffgXE2wr/owQkZBffmXX4CNh9GLDQXgj+GWPkZEvGC6rd4p8/pk3R23Eyo3Di14Lfrpk8P7XX7Dt24g5HxUAWvO004iQG2034h/Y5in5/HVETFg58G5Cy4i/4zIiMX8XrMIm4lW7EQ+EJrSczTdcK5GY30Sr0CYst/9kx74YkBrx62+4CD9/dTHh4GD77u1d3ZWQTlPZVO0iv/3kShhsO2eciX4EytbI/RdUC9F9GVLC/acj7o3LMrSM+A2TDWmsoA7eRcH6v59iRdB1+P0fmFwNMb/8xV3/ebP2sqnifz0MR0VIz03DHvTiUV5GYzvoDz27ZBMpKSkpKSkpKSkpKSkpKSkpKSkpKSkpYdH/AESsdJfPiua9AAAAAElFTkSuQmCC"
                                        class="w-12 h-12 object-contain" alt="Wave">
                                    <span class="text-xs font-bold">Wave</span>
                                </button>
                                <button type="button"
                                    class="operator-card p-3 border-2 rounded-xl transition hover:shadow-md flex flex-col items-center gap-2"
                                    data-op="Orange">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c8/Orange_logo.svg/1024px-Orange_logo.svg.png"
                                        class="w-12 h-12 object-contain" alt="Orange">
                                    <span class="text-xs font-bold font-mono">Orange</span>
                                </button>
                                <button type="button"
                                    class="operator-card p-3 border-2 rounded-xl transition hover:shadow-md flex flex-col items-center gap-2"
                                    data-op="MTN">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/af/MTN_Logo.svg/2048px-MTN_Logo.svg.png"
                                        class="w-12 h-12 object-contain" alt="MTN">
                                    <span class="text-xs font-bold">MTN</span>
                                </button>
                                <button type="button"
                                    class="operator-card p-3 border-2 rounded-xl transition hover:shadow-md flex flex-col items-center gap-2"
                                    data-op="Moov">
                                    <img src="data:image/png;base64,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"
                                        180: class="text-xs font-bold">Moov</span>
                                    181: </button>
                            </div>
                        </div>

                        <div id="mobile-number-input"
                            class="hidden bg-blue-50 p-6 rounded-2xl border border-blue-200 text-center animate-pulse-once">
                            <p class="text-sm text-gray-600 mb-4">Entrez votre num√©ro <span id="display-op"
                                    class="font-bold text-blue-600"></span> pour payer</p>
                            <div class="max-w-xs mx-auto">
                                <input type="tel" id="mobile-money-num" placeholder="07 XX XX XX XX"
                                    class="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-center text-xl tracking-widest font-bold">
                            </div>
                            <p class="text-xs text-gray-500 mt-4">
                                <i class="fa-solid fa-lock"></i> Paiement s√©curis√© et instantan√©.
                            </p>
                        </div>

                        <button type="submit" id="btn-pay" disabled
                            class="w-full mt-6 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-bold py-4 rounded-xl transition-all shadow-lg flex items-center justify-center gap-2 active:scale-95">
                            <i class="fa-solid fa-shield-check"></i> Payer et Valider
                        </button>
                    </div>

                    <div id="payment-cash" class="hidden">
                        <div class="bg-yellow-50 p-8 rounded-2xl border border-yellow-200 text-center space-y-4">
                            <i class="fa-solid fa-hand-holding-dollar text-5xl text-yellow-600"></i>
                            <h3 class="text-xl font-bold text-gray-800">Paiement √† la livraison</h3>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                Vous r√©glerez le montant total en esp√®ces directement lors de la livraison ou √† la fin
                                du service.
                            </p>
                        </div>
                        <button type="submit"
                            class="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg flex items-center justify-center gap-2 active:scale-95">
                            <i class="fa-solid fa-check-circle"></i> Confirmer la commande
                        </button>
                    </div>

                    <div class="pt-2 text-center">
                        <button type="button" id="btn-back"
                            class="text-sm text-gray-500 hover:text-gray-700 underline transition group">
                            <i
                                class="fa-solid fa-chevron-left mr-1 group-hover:-translate-x-1 transition-transform"></i>
                            Retour
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div th:replace="fragments/footer :: footer"></div>

    <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", () => {
            const categorie = /*[[${produit.categorie}]]*/ '';
            const catLower = (categorie || '').toLowerCase();

            const fieldsVoiture = document.getElementById('fields-voiture');
            const fieldsResidence = document.getElementById('fields-residence');
            const fieldsPoulet = document.getElementById('fields-poulet');

            if (catLower.includes('voiture') || catLower.includes('v√©hicule')) {
                fieldsVoiture.classList.remove('hidden');
            } else if (catLower.includes('residence') || catLower.includes('r√©sidence')) {
                fieldsResidence.classList.remove('hidden');
            } else if (catLower.includes('poulet')) {
                fieldsPoulet.classList.remove('hidden');
            }

            const step1 = document.getElementById('step-1');
            const step2 = document.getElementById('step-2');
            const btnNext = document.getElementById('btn-next');
            const btnBack = document.getElementById('btn-back');
            const progressBar = document.getElementById('progress-bar');
            const step2Indicator = document.getElementById('step-2-indicator');

            const paymentSelect = document.getElementById('payment-select');
            const paymentMobile = document.getElementById('payment-mobile');
            const paymentCash = document.getElementById('payment-cash');

            const operatorCards = document.querySelectorAll('.operator-card');
            const hiddenOp = document.getElementById('hidden-operateur');
            const mobileInputArea = document.getElementById('mobile-number-input');
            const displayOp = document.getElementById('display-op');
            const mobileMoneyNum = document.getElementById('mobile-money-num');
            const btnPay = document.getElementById('btn-pay');

            btnNext.addEventListener('click', () => {
                const inputNom = document.getElementById('input-nom');
                const inputTel = document.getElementById('input-tel');
                const inputLoc = document.getElementById('input-loc');

                if (!inputNom.value || !inputTel.value || !inputLoc.value) {
                    alert("Veuillez remplir les informations obligatoires.");
                    return;
                }

                step1.classList.add('hidden');
                step2.classList.remove('hidden');
                step2Indicator.classList.remove('opacity-50');
                step2Indicator.querySelector('div').classList.add('bg-blue-600', 'text-white');
                progressBar.classList.add('w-full');

                if (paymentSelect.value === 'TELEPHONE') {
                    paymentMobile.classList.remove('hidden');
                    paymentCash.classList.add('hidden');
                } else {
                    paymentCash.classList.remove('hidden');
                    paymentMobile.classList.add('hidden');
                }
            });

            btnBack.addEventListener('click', () => {
                step2.classList.add('hidden');
                step1.classList.remove('hidden');
                step2Indicator.classList.add('opacity-50');
                step2Indicator.querySelector('div').classList.remove('bg-blue-600', 'text-white');
                progressBar.classList.remove('w-full');
            });

            operatorCards.forEach(card => {
                card.addEventListener('click', () => {
                    operatorCards.forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    const op = card.getAttribute('data-op');
                    hiddenOp.value = op;
                    displayOp.textContent = op;
                    mobileInputArea.classList.remove('hidden');
                    mobileMoneyNum.focus();
                    validateStep2();
                });
            });

            mobileMoneyNum.addEventListener('input', validateStep2);

            function validateStep2() {
                btnPay.disabled = !(hiddenOp.value && mobileMoneyNum.value.length >= 8);
            }
        });
    </script>
</body>

</html>