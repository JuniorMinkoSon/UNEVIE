<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${service.nom} + ' | UneVie'">Service | UneVie</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { premium: { orange: '#f97316', dark: '#1a1a1a' } },
                    fontFamily: { sans: ['Outfit', 'sans-serif'] }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-50 min-h-screen font-sans">

    <div th:replace="~{fragments/header :: header}"></div>

    <div class="container mx-auto px-6 py-12">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">

            <!-- Service Details -->
            <div class="lg:col-span-2">
                <!-- Breadcrumb -->
                <nav class="flex items-center gap-2 text-slate-400 text-sm mb-6">
                    <a th:href="@{/}" class="hover:text-slate-600">Accueil</a>
                    <i class="fa-solid fa-chevron-right text-xs"></i>
                    <a th:href="@{/reservation/secteurs}" class="hover:text-slate-600">Secteurs</a>
                    <i class="fa-solid fa-chevron-right text-xs"></i>
                    <span class="text-slate-800 font-bold" th:text="${service.nom}">Service</span>
                </nav>

                <!-- Image -->
                <div class="h-80 bg-slate-200 rounded-3xl overflow-hidden mb-8">
                    <img th:if="${service.imageUrl != null}" th:src="${service.imageUrl}"
                        class="w-full h-full object-cover" alt="">
                    <div th:unless="${service.imageUrl != null}" class="w-full h-full flex items-center justify-center">
                        <i class="fa-solid fa-image text-slate-400 text-5xl"></i>
                    </div>
                </div>

                <!-- Info -->
                <div class="bg-white rounded-3xl p-8 shadow-lg mb-8">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-14 h-14 bg-premium-orange rounded-xl flex items-center justify-center">
                            <i class="fa-solid fa-store text-white text-xl"></i>
                        </div>
                        <div>
                            <p class="text-slate-400 text-sm">Proposé par</p>
                            <p class="font-bold text-slate-800 text-lg" th:text="${fournisseur.nomEntreprise}">
                                Fournisseur</p>
                        </div>
                    </div>

                    <div class="flex justify-between items-start mb-4">
                        <h1 class="text-3xl font-extrabold text-slate-800" th:text="${service.nom}">Service</h1>
                        <div class="flex items-center gap-1 text-amber-500 font-bold">
                            <i class="fa-solid fa-star"></i>
                            <span
                                th:text="${service.noteMoyenne != null ? #numbers.formatDecimal(service.noteMoyenne, 1, 1) : '0.0'}">0.0</span>
                            <span class="text-slate-300 font-medium text-sm"
                                th:text="'(' + ${service.nombreAvis} + ')'">(0)</span>
                        </div>
                    </div>

                    <p class="text-slate-600 leading-relaxed" th:text="${service.description}">Description</p>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8 pt-6 border-t border-slate-100">
                        <div class="text-center p-4 bg-slate-50 rounded-xl">
                            <i class="fa-solid fa-tag text-premium-orange text-xl mb-2"></i>
                            <p class="text-2xl font-extrabold text-slate-800"
                                th:text="${#numbers.formatDecimal(service.prix, 0, 'COMMA', 0, 'POINT')}">0</p>
                            <p class="text-slate-400 text-sm">FCFA</p>
                        </div>
                        <div th:if="${service.prixParJour != null}" class="text-center p-4 bg-slate-50 rounded-xl">
                            <i class="fa-solid fa-calendar-day text-blue-500 text-xl mb-2"></i>
                            <p class="text-2xl font-extrabold text-slate-800"
                                th:text="${#numbers.formatDecimal(service.prixParJour, 0, 'COMMA', 0, 'POINT')}">0</p>
                            <p class="text-slate-400 text-sm">FCFA/jour</p>
                        </div>
                        <div th:if="${service.capacite != null}" class="text-center p-4 bg-slate-50 rounded-xl">
                            <i class="fa-solid fa-users text-emerald-500 text-xl mb-2"></i>
                            <p class="text-2xl font-extrabold text-slate-800" th:text="${service.capacite}">0</p>
                            <p class="text-slate-400 text-sm">Capacité</p>
                        </div>
                        <div class="text-center p-4 bg-slate-50 rounded-xl">
                            <i class="fa-solid fa-check-circle text-amber-500 text-xl mb-2"></i>
                            <p class="text-2xl font-extrabold text-slate-800" th:text="${service.nombreReservations}">0
                            </p>
                            <p class="text-slate-400 text-sm">Réalisés</p>
                        </div>
                    </div>
                </div>

                <!-- Avis des clients -->
                <div class="bg-white rounded-3xl p-8 shadow-lg mt-8">
                    <h2 class="text-2xl font-extrabold text-slate-800 mb-8 flex items-center gap-3">
                        <i class="fa-solid fa-comments text-premium-orange"></i>
                        Avis des clients
                        <span class="text-sm font-bold text-slate-400 ml-auto"
                            th:text="${evaluations.size()} + ' avis'">0 avis</span>
                    </h2>

                    <div th:if="${evaluations.empty}" class="py-12 text-center text-slate-400 italic">
                        Aucun avis pour le moment. Soyez le premier à donner votre avis après avoir utilisé ce service !
                    </div>

                    <div class="space-y-8">
                        <div th:each="ev : ${evaluations}"
                            class="pb-8 border-b border-slate-50 last:border-0 last:pb-0">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center text-slate-400">
                                        <i class="fa-solid fa-user"></i>
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-800" th:text="${ev.client.nom}">Client</p>
                                        <p class="text-[10px] text-slate-400 uppercase tracking-widest"
                                            th:text="${#temporals.format(ev.created_at, 'dd MMM yyyy')}">Date</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-1 text-amber-500 text-xs">
                                    <i th:each="i : ${#numbers.sequence(1, 5)}" class="fa-star"
                                        th:classappend="${i <= ev.note ? 'fa-solid' : 'fa-regular'}"></i>
                                </div>
                            </div>
                            <p class="text-slate-600 text-sm leading-relaxed italic" th:text="${ev.commentaire}">
                                Commentaire...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reservation Form -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-3xl p-8 shadow-xl sticky top-24">
                    <h2 class="text-2xl font-extrabold text-slate-800 mb-6">
                        <i class="fa-solid fa-calendar-plus text-premium-orange mr-2"></i>
                        Réserver
                    </h2>

                    <form th:action="@{/reservation/reserver}" method="post" th:object="${reservationDto}">
                        <input type="hidden" th:field="*{serviceId}">

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-2">Votre nom *</label>
                                <input type="text" th:field="*{nomClient}" required
                                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-premium-orange focus:border-transparent">
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-2">Téléphone *</label>
                                <input type="tel" th:field="*{telephone}" required
                                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-premium-orange focus:border-transparent">
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-2">Email</label>
                                <input type="email" th:field="*{email}"
                                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-premium-orange focus:border-transparent">
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-2">Date du service *</label>
                                <input type="date" th:field="*{dateService}" required
                                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-premium-orange focus:border-transparent">
                            </div>

                            <!-- Champs optionnels selon secteur -->
                            <div th:if="${service.fournisseur.secteur.name() == 'VOITURE'}">
                                <label class="block text-sm font-bold text-slate-700 mb-2">Date de fin</label>
                                <input type="date" th:field="*{dateFinService}"
                                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-premium-orange focus:border-transparent">

                                <label class="flex items-center gap-3 mt-4 cursor-pointer">
                                    <input type="checkbox" th:field="*{avecChauffeur}"
                                        class="w-5 h-5 rounded border-slate-300 text-premium-orange focus:ring-premium-orange">
                                    <span class="text-slate-700 font-medium">Avec chauffeur</span>
                                </label>
                            </div>

                            <div
                                th:if="${service.fournisseur.secteur.name() == 'EVENEMENTIEL' || service.fournisseur.secteur.name() == 'ALIMENTAIRE'}">
                                <label class="block text-sm font-bold text-slate-700 mb-2">Nombre de personnes</label>
                                <input type="number" th:field="*{nombrePersonnes}" min="1"
                                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-premium-orange focus:border-transparent">
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-2">Notes (optionnel)</label>
                                <textarea th:field="*{notes}" rows="3"
                                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-premium-orange focus:border-transparent resize-none"></textarea>
                            </div>

                            <!-- Contrat Juridique pour Voitures -->
                            <div th:if="${service.fournisseur.secteur.name() == 'VOITURE'}"
                                class="mt-6 p-4 bg-premium-orange/5 border border-premium-orange/20 rounded-2xl">
                                <h4 class="text-sm font-bold text-premium-orange mb-2 flex items-center gap-2">
                                    <i class="fa-solid fa-file-contract"></i>
                                    Contrat de location
                                </h4>
                                <p class="text-xs text-slate-500 mb-4 uppercase tracking-[0.1em] font-medium">Conditions
                                    légales de location</p>

                                <div
                                    class="h-32 overflow-y-auto bg-white/50 border border-white p-3 rounded-xl text-[10px] text-slate-600 mb-4 font-mono leading-relaxed">
                                    CONTRAT DE LOCATION DE VÉHICULE
                                    ------------------------------
                                    Le client reconnaît avoir pris connaissance des conditions générales de location de
                                    l'entreprise <span th:text="${fournisseur.nomEntreprise}"></span>.

                                    1. Le client s'engage à être titulaire d'un permis de conduire valide.
                                    2. Le véhicule est livré avec le plein de carburant et doit être restitué de même.
                                    3. Toute dégradation constatée lors du retour sera facturée au client.
                                    4. L'utilisation du véhicule est limitée au territoire national sauf accord écrit du
                                    loueur.

                                    En cochant la case ci-dessous, vous acceptez que cette réservation soit soumise aux
                                    conditions du contrat juridique qui sera généré avec vos informations personnelles.
                                </div>

                                <label class="flex items-start gap-3 cursor-pointer group">
                                    <input type="checkbox" th:field="*{contratAccepte}" required
                                        class="mt-1 w-5 h-5 rounded border-premium-orange/30 text-premium-orange focus:ring-premium-orange transition-all">
                                    <span class="text-xs text-slate-700 font-bold group-hover:text-premium-orange">
                                        J'accepte les termes du contrat juridique de location *
                                    </span>
                                </label>
                                <p th:if="${errorContrat}" class="mt-2 text-[10px] text-red-500 font-bold"
                                    th:text="${errorContrat}"></p>
                            </div>
                        </div>

                        <div class="bg-slate-50 rounded-xl p-4 mt-6">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-600">Total estimé</span>
                                <span class="text-2xl font-extrabold text-slate-800">
                                    <span
                                        th:text="${#numbers.formatDecimal(service.prix, 0, 'COMMA', 0, 'POINT')}">0</span>
                                    FCFA
                                </span>
                            </div>
                        </div>

                        <button type="submit"
                            class="w-full mt-6 py-4 bg-gradient-to-r from-premium-orange to-amber-500 text-white font-bold text-lg rounded-xl hover:from-orange-600 hover:to-amber-600 transition-all shadow-lg shadow-premium-orange/30">
                            <i class="fa-solid fa-calendar-check mr-2"></i>
                            Réserver maintenant
                        </button>
                    </form>
                </div>
            </div>

        </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>

</body>

</html>