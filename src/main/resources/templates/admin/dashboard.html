<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">

<head>
    <div th:replace="~{fragments/head :: head(title='Tableau de Bord ‚Äî Administration BarakaWeb')}"></div>
    <link rel="stylesheet" th:href="@{/css/admin-dashboard.css}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body
    style="background:#f9fafb; font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display','Segoe UI',Roboto,sans-serif; color:#1d1d1f;">

    <!-- ‚úÖ ADMIN LAYOUT -->
    <div th:replace="~{fragments/admin-layout :: layout(content=~{::section})}">
        <section>
            <div class="container-fluid py-4">

                <!-- üî¢ STATS -->
                <section class=" mb-5">
                    <div class="stats-row">
                        <div class="stat-card" th:each="entry : ${stats}">

                            <div>
                                <h6 th:text="${entry.key}"></h6>
                                <h2 th:text="${entry.value}"></h2>
                            </div>
                        </div>
                    </div>
                </section>
                <br />

                <section class="dashboard-card mb-5">
                    <h4 class="section-title">
                        <i class="fa-solid fa-chart-bar text-primary"></i>
                        Commandes Mensuelles
                    </h4>
                    <div style="height: 300px; position: relative;">
                        <canvas id="orderChart"></canvas>
                    </div>
                </section>

                <script th:inline="javascript">
                    document.addEventListener("DOMContentLoaded", () => {
                        const stats = /*[[${orderStats}]]*/ {};
                        const labels = Object.keys(stats);
                        const data = Object.values(stats);

                        const ctx = document.getElementById('orderChart').getContext('2d');
                        new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Nombre de commandes',
                                    data: data,
                                    backgroundColor: '#0d6efd',
                                    borderRadius: 8,
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: { stepSize: 1 }
                                    }
                                },
                                plugins: {
                                    legend: { display: false }
                                }
                            }
                        });
                    });
                </script>

                <!-- üßæ DERNI√àRES COMMANDES -->
                <section class="dashboard-card mt-5">
                    <h4 class="section-title">
                        <i class="fa-solid fa-clock-rotate-left text-primary"></i>
                        Derni√®res Commandes
                    </h4>

                    <!-- Aucun r√©sultat -->
                    <div th:if="${#lists.isEmpty(recentCommandes)}" class="empty-state">
                        <i class="fa-solid fa-inbox"></i>
                        <p>Aucune commande r√©cente.</p>
                    </div>

                    <!-- Tableau -->
                    <div th:if="${!#lists.isEmpty(recentCommandes)}" class="table-responsive">
                        <table class="table align-middle text-center mb-0">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Client</th>
                                    <th>Email</th>
                                    <th>T√©l√©phone</th>
                                    <th>Total</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="cmd : ${recentCommandes}">
                                    <td class="fw-bold text-primary" th:text="${cmd.id}"></td>
                                    <td th:text="${cmd.user != null ? cmd.user.nom : 'Anonyme'}"></td>
                                    <td class="text-muted" th:text="${cmd.user != null ? cmd.user.email : '‚Äî'}"></td>
                                    <td class="text-muted" th:text="${cmd.user != null ? cmd.user.telephone : '‚Äî'}">
                                    </td>
                                    <td class="fw-bold text-success" th:text="${cmd.total} + ' FCFA'"></td>
                                    <td>
                                        <span class="badge rounded-pill"
                                            th:classappend="${cmd.statut == 'EN_ATTENTE' ? 'bg-warning text-dark' : cmd.statut == 'EN_COURS' ? 'bg-primary' : 'bg-success'}"
                                            th:text="${cmd.statut}">
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

            </div>
        </section>
    </div>



</body>

</html>