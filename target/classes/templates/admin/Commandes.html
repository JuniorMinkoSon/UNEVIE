<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">

<head>
    <div th:replace="~{fragments/head :: head (title='Commandes clients | UNEVIE')}"></div>
    <link rel="stylesheet" th:href="@{/css/admin-dashboard.css}">
</head>

<body>

<div th:replace="~{fragments/admin-layout :: layout(content=~{::section})}">

    <section>
        <div class="container-fluid">
            <div class="glass-card">

                <!-- ===== TITRE ===== -->
                <h2 class="section-title text-center mb-4">
                    <i class="fa-solid fa-box-open text-primary"></i>
                    Commandes Clients
                </h2>

                <!-- ===== AUCUNE COMMANDE ===== -->
                <div th:if="${#lists.isEmpty(commandes)}" class="empty-state text-center py-5">
                    <i class="fa-solid fa-inbox fa-3x mb-3 text-muted"></i>
                    <p class="text-muted">Aucune commande enregistrée pour le moment</p>
                </div>

                <!-- ===== TABLE COMMANDES ===== -->
                <div th:if="${!#lists.isEmpty(commandes)}" class="table-responsive">

                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Client</th>
                            <th>Téléphone</th>
                            <th>Produit</th>
                            <th>Paiement</th>
                            <th>Date</th>
                            <th>Total</th>
                            <th>Statut</th>
                            <th>Action</th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr th:each="cmd : ${commandes}">

                            <!-- ID -->
                            <td class="fw-bold text-primary" th:text="'#' + ${cmd.id}"></td>

                            <!-- CLIENT -->
                            <td th:text="${cmd.user != null ? cmd.user.nom : cmd.nomClient}"></td>

                            <!-- TELEPHONE -->
                            <td th:text="${cmd.user != null ? cmd.user.telephone : cmd.telephone}"></td>

                            <!-- PRODUIT -->
                            <td th:text="${cmd.produit.nom}"></td>

                            <!-- MODE DE PAIEMENT -->
                            <td>
                                <span class="badge bg-info text-dark"
                                      th:text="${cmd.modePaiement}">
                                </span>
                            </td>

                            <!-- DATE -->
                            <td th:text="${#temporals.format(cmd.dateCommande, 'dd/MM/yyyy HH:mm')}"></td>

                            <!-- TOTAL -->
                            <td class="fw-bold text-success"
                                th:text="${cmd.total} + ' FCFA'"></td>

                            <!-- STATUT -->
                            <td>
                                <span class="badge status-badge"
                                      th:classappend="'status-' + ${cmd.statut}"
                                      th:text="${cmd.statut}">
                                </span>
                            </td>

                            <!-- ACTION -->
                            <td>
                                <form th:action="@{'/admin/commandes/update/' + ${cmd.id}}"
                                      method="post"
                                      class="d-flex gap-2 align-items-center">

                                    <select name="statut"
                                            class="form-select form-select-sm"
                                            style="min-width: 130px;">
                                        <option value="EN_ATTENTE"
                                                th:selected="${cmd.statut == 'EN_ATTENTE'}">
                                            En attente
                                        </option>
                                        <option value="EN_COURS"
                                                th:selected="${cmd.statut == 'EN_COURS'}">
                                            En cours
                                        </option>
                                        <option value="LIVRÉ"
                                                th:selected="${cmd.statut == 'LIVRÉ'}">
                                            Livré
                                        </option>
                                    </select>

                                    <button type="submit"
                                            class="btn btn-primary btn-sm">
                                        <i class="fa fa-sync-alt"></i>
                                    </button>
                                </form>
                            </td>

                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ===== RETOUR DASHBOARD ===== -->
                <div class="text-center mt-4">
                    <a th:href="@{/admin/dashboard}" class="btn btn-outline-primary">
                        <i class="fa-solid fa-arrow-left"></i>
                        Retour au tableau de bord
                    </a>
                </div>

            </div>
        </div>
    </section>

</div>

</body>
</html>
